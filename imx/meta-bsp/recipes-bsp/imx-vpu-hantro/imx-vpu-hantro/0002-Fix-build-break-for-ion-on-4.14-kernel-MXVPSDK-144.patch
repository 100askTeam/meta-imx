From 6ff4fd8d585b77b206cefda89d68c199ee430039 Mon Sep 17 00:00:00 2001
From: Tom Hochstein <tom.hochstein@nxp.com>
Date: Fri, 17 Aug 2018 12:13:31 -0500
Subject: [PATCH 2/2] Fix build break for ion on 4.14 kernel [MXVPSDK-144]

The kernel header version check for the conditional
ion code should be testing if we have a 4.9 or 4.14 kernel.
What was coded tests that the kernel version is less
than 4.14.34. This causes a build break for 4.14 builds
because the standard libc headers are version 4.14.0.

Signed-off-by: Tom Hochstein <tom.hochstein@nxp.com>
---
 decoder_sw/software/linux/dwl/dwl_linux.c                 | 6 +++---
 h1_encoder/software/linux_reference/ewl/ewl_x280_common.c | 6 +++---
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/decoder_sw/software/linux/dwl/dwl_linux.c b/decoder_sw/software/linux/dwl/dwl_linux.c
index f2e1229..ff6bdf5 100755
--- a/decoder_sw/software/linux/dwl/dwl_linux.c
+++ b/decoder_sw/software/linux/dwl/dwl_linux.c
@@ -876,7 +876,7 @@ void DWLFreeRefFrm(const void *instance, struct DWLLinearMem *info) {
                         parameters are returned
 ------------------------------------------------------------------------------*/
 #ifdef USE_ION
-#if LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#if LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 i32 DWLMallocLinear(const void *instance, u32 size, struct DWLLinearMem *info) {
   struct HX170DWL *dec_dwl = (struct HX170DWL *)instance;
 
@@ -1022,7 +1022,7 @@ bail:
 #endif
 }
 
-#else //LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#else //LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 i32 DWLMallocLinear(const void *instance, u32 size, struct DWLLinearMem *info) {
   struct HX170DWL *dec_dwl = (struct HX170DWL *)instance;
 
@@ -1133,7 +1133,7 @@ bail:
   return DWL_ERROR;
 }
 
-#endif //LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#endif //LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 
 #else  //USE_ION
 
diff --git a/h1_encoder/software/linux_reference/ewl/ewl_x280_common.c b/h1_encoder/software/linux_reference/ewl/ewl_x280_common.c
index 82b4836..eb5a637 100755
--- a/h1_encoder/software/linux_reference/ewl/ewl_x280_common.c
+++ b/h1_encoder/software/linux_reference/ewl/ewl_x280_common.c
@@ -659,7 +659,7 @@ void EWLFreeRefFrm(const void *instance, EWLLinearMem_t * info)
                         buffer parameters are returned
 ------------------------------------------------------------------------------*/
 #ifdef USE_ION
-#if LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#if LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 
 i32 EWLMallocLinear(const void *instance, u32 size, EWLLinearMem_t * info)
 {
@@ -761,7 +761,7 @@ i32 EWLMallocLinear(const void *instance, u32 size, EWLLinearMem_t * info)
 #endif
 }
 
-#else  // LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#else  // LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 i32 EWLMallocLinear(const void *instance, u32 size, EWLLinearMem_t * info)
 {
     hx280ewl_t *enc_ewl = (hx280ewl_t *) instance;
@@ -843,7 +843,7 @@ i32 EWLMallocLinear(const void *instance, u32 size, EWLLinearMem_t * info)
       return EWL_ERROR;
 }
 
-#endif // LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 34)
+#endif // LINUX_VERSION_CODE < KERNEL_VERSION(4, 14, 0)
 
 #else //USE_ION
 
-- 
2.7.4

